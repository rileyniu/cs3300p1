<!DOCTYPE HTML>
<html>
  <body>
  <style>
    svg { border: solid #ccc 1px; }
  </style>
    <p id="p1">
      <script src="https://d3js.org/d3.v4.min.js"></script>
      <script src="https://d3js.org/topojson.v2.min.js"></script>

<!--         ////%%%%%%%%%%%%%%%%% <BLS CHANGE> %%%%%%%%%%%%%%
 -->
      <svg height="1200" width="1000" id="graph1"> </svg>
      <script> 
      var svg = d3.select("#graph1");
      var min = new Date(2017,0,15);
      var max = new Date(2018,1,18);
      var headlineData;

      var datescale = d3.scaleTime() // DATES
        .domain([min, max])
        .range([100, 1200-50]); 
      var priceScale = d3.scaleLinear() // SEARCHES
        .domain([0, 20000])
        .range([50,600-50]); 
      var searchScale = d3.scaleLinear() // PRICES
        .domain([0, 100])
        .range([50, 600-50]); 

      var parseTime = d3.timeParse("%Y-%m-%d");
      var parseTime2 = d3.timeParse(" %B %d, %Y");

      var linegen = d3.line() // PRICES (blue)
            .y(function(d) {return datescale(parseTime(d.date)); })
            .x(function(d) {return priceScale(d.close); })
      var linegen2 = d3.line() // SEARCHES (red)
            .y(function(d) {return datescale(parseTime(d.week)); })
            .x(function(d) {return searchScale(d.priority); })
      d3.csv("at.csv", function(d) {
        //console.log(d);
        var priceAxis = d3.axisTop(priceScale); // PRICES
        var searchAxis = d3.axisTop(searchScale); // SEARCHES
      svg.append("g")
        .classed('x axis', true) // previously ".classed('x axis', true)"
        .call(priceAxis)
        .attr('transform', 'translate(0, 70)');
      svg.append("g")
        .classed('x axis', true) // previously ".classed('y axis', true)"
        .call(searchAxis)
        .attr('transform', 'translate(0, 100)'); // SEARCHES
      svg.append("path")
        .attr("d", linegen(d)) // PRICE
        .attr("stroke","blue")
        .attr("fill","none")
        .attr("stroke-width","2px");
        });

    d3.csv("multiTimeline.csv", function(d) { // SEARCHES
      var dateAxis = d3.axisLeft(datescale); // DATES
        svg.append("path")
        .attr("d", linegen2(d))
        .attr("stroke","red")
        .attr("fill","none")
        .attr("stroke-width","5px");
      svg.append("g")
        .classed('y axis', true)
        .call(dateAxis)
        .attr('transform', 'translate(50, 0)');
        
  ////%%%%%%%%%%%%%%%%% </BLS CHANGE> %%%%%%%%%%%%%%
        d3.csv("btc_reduced.csv", function(data){
          headlineData = data;
          showText();
        });



      function showText(){
        headlineData.forEach(function (d) {
          console.log(d.EventName);
          console.log(parseTime2(d.Date));

          svg.append("text").text(d.EventName)
            .attr("x", 630)
            .attr("y", datescale(parseTime2(d.Date)))
            .attr("font-size", "10px")
            .attr("fill", "black");

            svg.append("text").text(d.PercChange)
            .attr("x", 560)
            .attr("y", datescale(parseTime2(d.Date)))
            .attr("font-size", "10px")
            .attr("fill", "black");

            svg.append("text").text(d.UpDownUnChanged)
            .attr("x", 595)
            .attr("y", datescale(parseTime2(d.Date)))
            .attr("font-size", "10px")
            .attr("fill", "black");

          svg.append("line")
               .attr("x1", priceScale(d.PriceOnDate))
               .attr("y1", datescale(parseTime2(d.Date)))
               .attr("x2", 550)
               .attr("y2", datescale(parseTime2(d.Date)))
               .attr("stroke-width", 0.5)
               .attr("stroke", "black");


          });

      }

    });


      </script>
    </p>
  